<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkLocker - Unlock Premium Links</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* Enhanced Backgrounds */
            --bg-main: #090d0a;
            --bg-secondary: #0d120f;
            --bg-card: #121915;
            --bg-card-hover: #171f19;
            /* Enhanced Text */
            --text-primary: #f4faf7;
            --text-secondary: #a7c0b4;
            --text-muted: #7e958a;
            /* Enhanced Accent */
            --accent: #22c55e;
            --accent-dark: #16a34a;
            --accent-glow: rgba(34, 197, 94, 0.5);
            /* Enhanced Borders */
            --border: rgba(255, 255, 255, 0.1);
            --border-strong: rgba(34, 197, 94, 0.4);
            /* Enhanced Buttons */
            --btn-bg: #17231e;
            --btn-hover: #1e2a24;
            /* Status */
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            /* Platform colors with gradients */
            --youtube: linear-gradient(135deg, #ff0000, #cc0000);
            --instagram: linear-gradient(135deg, #e4405f, #c13584);
            --twitter: linear-gradient(135deg, #000000, #1a1a1a);
            --facebook: linear-gradient(135deg, #1877f2, #166fe5);
            --tiktok: linear-gradient(135deg, #000000, #1a1a1a);
            --soundcloud: linear-gradient(135deg, #ff5500, #e64d00);
            --spotify: linear-gradient(135deg, #1db954, #1ed760);
        }
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(ellipse at top, var(--bg-main) 0%, #0b0f0d 50%, #0a0e0b 100%);
            color: var(--text-primary);
            overflow-x: hidden;
        }
        * {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        button:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 12px 40px rgba(0,0,0,0.4);
        }
        .card {
            background: linear-gradient(145deg, var(--bg-card), var(--bg-card-hover));
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255,255,255,0.08);
            backdrop-filter: blur(16px);
            position: relative;
            overflow: hidden;
        }
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            opacity: 0.6;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: #062e16;
            border-radius: 20px;
            padding: 16px 32px;
            font-weight: 700;
            box-shadow: 0 8px 32px var(--accent-glow);
            border: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-size: 1.05rem;
        }
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.7s;
        }
        .btn-primary:hover::before {
            left: 100%;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--accent-dark), var(--accent));
            box-shadow: 0 12px 40px var(--accent-glow);
        }
        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: linear-gradient(135deg, var(--btn-bg), var(--btn-hover));
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 16px 32px;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-secondary:hover {
            border-color: var(--accent);
            box-shadow: 0 8px 32px var(--accent-glow);
            color: var(--text-primary);
        }
        .btn-platform {
            border-radius: 20px;
            padding: 20px 24px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            width: 100%;
            color: #fff;
            position: relative;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            font-size: 1.05rem;
        }
        .btn-platform i {
            font-size: 1.75rem;
        }
        .btn-platform::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.2);
            opacity: 0;
            transition: opacity 0.5s;
        }
        .btn-platform:hover::before {
            opacity: 1;
        }
        .btn-youtube { background: var(--youtube); }
        .btn-instagram { background: var(--instagram); }
        .btn-twitter { background: var(--twitter); border: 1px solid #333; }
        .btn-facebook { background: var(--facebook); }
        .btn-tiktok { background: var(--tiktok); border: 1px solid #333; }
        .btn-soundcloud { background: var(--soundcloud); }
        .btn-spotify { background: var(--spotify); }
        .btn-email { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .btn-platform:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.5);
        }
        .btn-platform:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .progress {
            background: var(--btn-bg);
            border-radius: 16px;
            overflow: hidden;
            height: 12px;
            margin: 20px 0;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.3);
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent), var(--accent-dark));
            box-shadow: 0 0 20px var(--accent-glow);
            transition: width 0.8s ease;
            position: relative;
        }
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .hidden {
            display: none !important;
        }
        input, textarea, select {
            background: linear-gradient(145deg, var(--bg-secondary), var(--bg-card));
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 18px 24px;
            color: var(--text-primary);
            width: 100%;
            box-sizing: border-box;
            transition: all 0.4s;
            font-size: 1.05rem;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 5px var(--accent-glow);
            transform: translateY(-2px);
            background: linear-gradient(145deg, var(--bg-card), var(--bg-card-hover));
        }
        input::placeholder, textarea::placeholder {
            color: var(--text-muted);
        }
        .sidebar {
            width: 320px;
            background: linear-gradient(to bottom, var(--bg-secondary), var(--bg-main));
            border-right: 1px solid var(--border);
            padding: 2.5rem 2rem;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            z-index: 40;
            transform: translateX(0);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 4px 0 40px rgba(0,0,0,0.3);
        }
        .sidebar.mobile-hidden {
            transform: translateX(-100%);
        }
        .main-content {
            margin-left: 0;
            padding: 2rem;
            transition: margin-left 0.5s ease;
            min-height: 100vh;
        }
        .main-content.with-sidebar {
            margin-left: 320px;
        }
        .top-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(24px);
            background: rgba(13, 19, 16, 0.7);
            border-radius: 24px;
            padding: 2rem;
            margin: -2rem -2rem 3rem -2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(12px);
        }
        .action-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            background: linear-gradient(145deg, var(--bg-secondary), var(--bg-card));
            border-radius: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }
        .stat-card {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-card-hover));
            border: 1px solid var(--border-strong);
            border-radius: 24px;
            padding: 2.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), transparent);
        }
        .stat-icon {
            width: 64px;
            height: 64px;
            border-radius: 20px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--bg-secondary), var(--btn-bg));
            font-size: 1.75rem;
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }
        .profile-completion {
            position: fixed;
            bottom: 2.5rem;
            right: 2.5rem;
            width: 360px;
            background: linear-gradient(135deg, var(--bg-card), var(--bg-card-hover));
            border: 1px solid var(--border-strong);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.35);
            z-index: 30;
        }
        .no-links {
            text-align: center;
            padding: 8rem 2rem;
            max-width: 700px;
            margin: 0 auto;
        }
        .no-links h3 {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--text-primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
        }
        .no-links p {
            color: var(--text-secondary);
            margin-bottom: 3rem;
            font-size: 1.25rem;
            line-height: 1.7;
        }
        .create-link-btn {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: #062e16;
            padding: 1.5rem 4rem;
            border-radius: 20px;
            font-weight: 800;
            border: none;
            cursor: pointer;
            display: block;
            margin: 0 auto;
            box-shadow: 0 12px 40px var(--accent-glow);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-size: 1.25rem;
        }
        .sidebar-nav {
            margin-bottom: 2.5rem;
        }
        .sidebar-nav h4 {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1.25rem;
            padding-left: 1.25rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.9;
        }
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 1.25rem 1.5rem;
            border-radius: 20px;
            cursor: pointer;
            color: var(--text-secondary);
            gap: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            position: relative;
        }
        .sidebar-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 4px;
            height: 0;
            background: var(--accent);
            transition: height 0.4s;
            border-radius: 0 2px 2px 0;
        }
        .sidebar-item:hover::before, .sidebar-item.active::before {
            height: 100%;
            top: 0;
        }
        .sidebar-item i {
            width: 28px;
            text-align: center;
            font-size: 1.25rem;
            opacity: 0.8;
        }
        .sidebar-item.active {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            box-shadow: 0 6px 24px var(--accent-glow);
            transform: translateX(8px);
        }
        .top-nav-add {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: #062e16;
            padding: 1.5rem 2rem;
            border-radius: 20px;
            font-weight: 800;
            border: none;
            cursor: pointer;
            margin-bottom: 2.5rem;
            width: 100%;
            text-align: left;
            box-shadow: 0 12px 40px var(--accent-glow);
            position: relative;
            overflow: hidden;
            font-size: 1.1rem;
        }
        .top-nav-add::before {
            content: '+';
            margin-right: 1rem;
            font-size: 1.75rem;
            font-weight: 300;
        }
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 2rem;
            left: 2rem;
            z-index: 50;
            background: linear-gradient(135deg, var(--bg-card), var(--bg-card-hover));
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 1.5rem;
            color: var(--text-primary);
            font-size: 1.75rem;
            cursor: pointer;
            backdrop-filter: blur(24px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.4);
            transition: all 0.4s;
        }
        .mobile-menu-toggle:hover {
            transform: scale(1.08);
            box-shadow: 0 16px 50px rgba(0,0,0,0.5);
        }
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            .sidebar {
                width: 90vw;
                max-width: 380px;
            }
            .main-content.with-sidebar {
                margin-left: 0;
            }
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            .profile-completion {
                width: calc(100vw - 4rem);
                right: 2rem;
                left: 2rem;
                bottom: 2rem;
            }
            .grid-cols-1 lg\\:grid-cols-3 {
                grid-template-columns: 1fr;
            }
            .top-header {
                padding: 1.5rem;
                margin: 0 1.5rem 2.5rem;
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            .no-links {
                padding: 6rem 1.5rem;
            }
            .hero-gradient {
                padding: 3rem 1.5rem;
            }
        }
        .analytics-placeholder {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-card-hover));
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 4rem;
            text-align: center;
            color: var(--text-muted);
            position: relative;
        }
        .analytics-placeholder::before {
            content: 'Coming Soon';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: #062e16;
            padding: 6px 24px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 700;
            box-shadow: 0 4px 12px var(--accent-glow);
        }
        .link-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2.5rem;
            border: 1px solid var(--border);
            border-radius: 24px;
            margin-bottom: 2rem;
            background: linear-gradient(145deg, var(--bg-card), var(--bg-card-hover));
            transition: all 0.5s;
            position: relative;
            overflow: hidden;
        }
        .link-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            opacity: 0;
            transition: opacity 0.5s;
        }
        .link-item:hover {
            border-color: var(--accent);
            box-shadow: 0 20px 60px var(--accent-glow);
            transform: translateY(-6px);
        }
        .link-item:hover::before {
            opacity: 1;
        }
        .fade-in {
            animation: fadeInUp 0.8s ease-out;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .hero-gradient {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, transparent 50%, rgba(34, 197, 94, 0.15) 100%);
            border-radius: 24px;
            padding: 5rem 3rem;
            margin-bottom: 4rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .glass-effect {
            background: rgba(13, 19, 16, 0.7);
            backdrop-filter: blur(24px);
            border: 1px solid var(--border);
            border-radius: 24px;
        }
        .coming-soon {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .coming-soon::after {
            content: 'Coming Soon';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--warning);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .spinner {
            border: 2px solid var(--border);
            border-top: 2px solid var(--accent);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .public-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(9, 13, 10, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            z-index: 100;
        }
        .public-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(9, 13, 10, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            text-align: center;
            z-index: 100;
            border-top: 1px solid var(--border);
        }
        .verification-checkbox {
            margin-left: 8px;
        }
        /* Wizard Styles */
        .wizard-stepper {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }
        .wizard-step {
            flex: 1;
            text-align: center;
            position: relative;
        }
        .wizard-step::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--border);
            z-index: -1;
        }
        .wizard-step.active::before {
            background: var(--accent);
        }
        .wizard-step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            font-weight: 700;
        }
        .wizard-step.active .wizard-step-number {
            background: var(--accent);
            color: #062e16;
            border-color: var(--accent);
        }
        .wizard-panel {
            display: none;
        }
        .wizard-panel.active {
            display: block;
            animation: fadeInUp 0.5s ease-out;
        }
        .drag-handle {
            cursor: grab;
            font-size: 1.2rem;
            color: var(--text-muted);
            user-select: none;
        }
        .drag-handle:active {
            cursor: grabbing;
        }
        .sortable-item {
            list-style: none;
        }
        .sortable-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-active { background: var(--success); color: white; }
        .status-paused { background: var(--warning); color: white; }
        .status-expired { background: var(--danger); color: white; }
        .qr-code {
            margin-top: 1rem;
            text-align: center;
        }
        .countdown {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
            margin: 1rem 0;
        }
        .email-input-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="App.ui.toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
    <!-- Layout Wrapper (Auth Only) -->
    <div id="appLayout" class="flex min-h-screen hidden">
        <!-- Sidebar with enhanced navigation -->
        <aside class="sidebar mobile-hidden" id="sidebar">
            <button class="top-nav-add" onclick="App.ui.showSection('create')">
                <i class="fas fa-rocket"></i> Create New Link
            </button>
            <nav class="sidebar-nav">
                <h4>Links</h4>
                <div class="sidebar-item active" id="navOverview" onclick="App.ui.showSection('dashboard')">
                    <i class="fas fa-chart-pie"></i> Dashboard
                </div>
                <div class="sidebar-item" id="navCreate" onclick="App.ui.showSection('create')">
                    <i class="fas fa-magic"></i> Create Link
                </div>
                <div class="sidebar-item" onclick="App.ui.showSection('shortenedLinks')">
                    <i class="fas fa-compress-alt"></i> Shortened Links
                </div>
            </nav>
            <nav class="sidebar-nav">
                <h4>Link-in-Bio</h4>
                <div class="sidebar-item" onclick="App.ui.showSection('linkInBio')">
                    <i class="fas fa-id-card"></i> Link-in-Bio Page
                </div>
            </nav>
            <nav class="sidebar-nav">
                <h4>Engagement</h4>
                <div class="sidebar-item" onclick="App.ui.showSection('emailLists')">
                    <i class="fas fa-mail-bulk"></i> Email Lists
                </div>
                <div class="sidebar-item" onclick="App.ui.showSection('audience')">
                    <i class="fas fa-user-friends"></i> Audience Insights
                </div>
            </nav>
            <nav class="sidebar-nav">
                <h4>Resources</h4>
                <div class="sidebar-item coming-soon" onclick="alert('Coming soon!')">
                    <i class="fas fa-folder-open"></i> File Library
                </div>
            </nav>
            <nav class="sidebar-nav">
                <h4>Settings</h4>
                <div class="sidebar-item" onclick="App.ui.showSection('settings')">
                    <i class="fas fa-sliders-h"></i> Account Settings
                </div>
            </nav>
            <nav class="sidebar-nav">
                <h4>Analytics</h4>
                <div class="sidebar-item coming-soon" onclick="alert('Coming soon!')">
                    <i class="fas fa-chart-line"></i> Advanced Analytics
                </div>
            </nav>
        </aside>
        <!-- Main Content with enhanced header -->
        <div class="flex-1">
            <header class="top-header glass-effect">
                <h2 id="pageTitle" class="text-3xl font-black flex items-center gap-4">
                    <i class="fas fa-home" style="color: var(--accent); font-size: 1.5rem;"></i> Dashboard
                </h2>
                <div class="flex items-center space-x-4">
                    <span id="userEmail" class="hidden sm:block bg-[var(--bg-secondary)] px-3 py-1 rounded-full text-sm" style="color: var(--text-secondary);"></span>
                    <button onclick="App.auth.logout()" class="btn-secondary flex items-center gap-3 px-8 py-4 text-lg font-semibold" style="border-radius: 16px;">
                        <i class="fas fa-sign-out-alt"></i> Sign Out
                    </button>
                </div>
            </header>
            <main class="main-content" id="mainContent">
                <!-- Enhanced Dashboard with charts -->
                <div id="dashboard" class="fade-in">
                    <div id="dashboardHero" class="hero-gradient text-center">
                        <h1 class="text-5xl font-black mb-6" style="color: var(--text-primary); background: linear-gradient(135deg, var(--text-primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                            Welcome Back, <span id="welcomeUser" style="color: var(--accent); font-size: 1.2em;">Creator</span>
                        </h1>
                        <p class="text-2xl mb-8 max-w-3xl mx-auto leading-relaxed" style="color: var(--text-secondary);">
                            Your links have unlocked <span id="totalUnlocksQuick" style="color: var(--accent); font-weight: 700;">0</span> moments for your audience. Let's create more magic today.
                        </p>
                        <button onclick="App.ui.showSection('create')" class="btn-primary inline-flex items-center gap-3 px-12 py-5 text-xl font-bold mx-auto">
                            <i class="fas fa-rocket"></i> Create Your First Link
                        </button>
                    </div>
                    <div id="statsGrid" class="stats-grid">
                        <div class="stat-card fade-in" style="animation-delay: 0.1s;">
                            <div class="stat-icon"><i class="fas fa-eye" style="color: var(--accent);"></i></div>
                            <h4 style="color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.8;">Total Views</h4>
                            <p id="totalViews" style="font-size: 3rem; font-weight: 900; color: var(--text-primary); margin: 0.5rem 0 0.25rem;">0</p>
                            <p class="text-sm" style="color: var(--text-muted);">+0% from last week</p>
                        </div>
                        <div class="stat-card fade-in" style="animation-delay: 0.2s;">
                            <div class="stat-icon"><i class="fas fa-unlock-alt" style="color: var(--accent);"></i></div>
                            <h4 style="color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.8;">Total Unlocks</h4>
                            <p id="totalUnlocks" style="font-size: 3rem; font-weight: 900; color: var(--text-primary); margin: 0.5rem 0 0.25rem;">0</p>
                            <p class="text-sm" style="color: var(--text-muted);">+0% from last week</p>
                        </div>
                        <div class="stat-card fade-in" style="animation-delay: 0.3s;">
                            <div class="stat-icon"><i class="fas fa-percentage" style="color: var(--accent);"></i></div>
                            <h4 style="color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.8;">Conversion Rate</h4>
                            <p id="conversionRate" style="font-size: 3rem; font-weight: 900; color: var(--text-primary); margin: 0.5rem 0 0.25rem;">0%</p>
                            <p class="text-sm" style="color: var(--text-muted);">+0% from last week</p>
                        </div>
                        <div class="stat-card fade-in" style="animation-delay: 0.4s;">
                            <div class="stat-icon"><i class="fas fa-envelope-open-text" style="color: var(--accent);"></i></div>
                            <h4 style="color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.8;">Email Subscribers</h4>
                            <p id="emailSubs" style="font-size: 3rem; font-weight: 900; color: var(--text-primary); margin: 0.5rem 0 0.25rem;">0</p>
                            <p class="text-sm" style="color: var(--text-muted);">+0% from last week</p>
                        </div>
                    </div>
                    <!-- Enhanced Links List with chart -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="card">
                            <h3 class="font-bold text-xl mb-6 flex items-center gap-3" style="color: var(--text-primary);">
                                <i class="fas fa-list"></i> Your Links
                            </h3>
                            <div id="linksList" class="space-y-4 max-h-96 overflow-y-auto">
                                <!-- Dynamic links -->
                            </div>
                        </div>
                        <div class="card">
                            <h3 class="font-bold text-xl mb-6 flex items-center gap-3" style="color: var(--text-primary);">
                                <i class="fas fa-chart-area"></i> Performance Chart
                            </h3>
                            <canvas id="performanceChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
                <div id="noLinksSection" class="hidden">
                    <div class="no-links">
                        <h3 style="color: var(--text-primary);">No links yet</h3>
                        <p style="color: var(--text-secondary);">Let your audience perform actions before unlocking your content.</p>
                        <button class="create-link-btn" onclick="App.ui.showSection('create')">+ Create a link</button>
                    </div>
                </div>
                <!-- Per-Link Analytics Page -->
                <div id="linkAnalytics" class="hidden fade-in">
                    <div class="card">
                        <h3 id="analyticsTitle" class="font-bold text-xl mb-6" style="color: var(--text-primary);">Link Analytics</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-eye" style="color: var(--accent);"></i></div>
                                <h4 style="color: var(--text-muted);">Views</h4>
                                <p id="linkViews" style="font-size: 2rem; font-weight: 900; color: var(--text-primary);">0</p>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-unlock-alt" style="color: var(--accent);"></i></div>
                                <h4 style="color: var(--text-muted);">Unlocks</h4>
                                <p id="linkUnlocks" style="font-size: 2rem; font-weight: 900; color: var(--text-primary);">0</p>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-percentage" style="color: var(--accent);"></i></div>
                                <h4 style="color: var(--text-muted);">Conversion</h4>
                                <p id="linkConversion" style="font-size: 2rem; font-weight: 900; color: var(--text-primary);">0%</p>
                            </div>
                        </div>
                        <h4 class="font-bold text-lg mb-4" style="color: var(--text-primary);">Action Breakdown</h4>
                        <div id="actionBreakdown" class="space-y-4"></div>
                        <canvas id="linkChart" width="400" height="200" class="mt-8"></canvas>
                        <button onclick="App.ui.showSection('dashboard')" class="btn-secondary mt-4">Back to Dashboard</button>
                    </div>
                </div>
                <!-- Step-Based Create Wizard -->
                <div id="create" class="hidden fade-in">
                    <div class="card">
                        <div class="wizard-stepper">
                            <div class="wizard-step active">
                                <div class="wizard-step-number">1</div>
                                <span style="color: var(--text-secondary);">Destination</span>
                            </div>
                            <div class="wizard-step">
                                <div class="wizard-step-number">2</div>
                                <span style="color: var(--text-secondary);">Actions</span>
                            </div>
                            <div class="wizard-step">
                                <div class="wizard-step-number">3</div>
                                <span style="color: var(--text-secondary);">Customize</span>
                            </div>
                            <div class="wizard-step">
                                <div class="wizard-step-number">4</div>
                                <span style="color: var(--text-secondary);">Publish</span>
                            </div>
                        </div>
                        <!-- Step 1: Destination -->
                        <div id="step1" class="wizard-panel active">
                            <h3 class="font-black text-3xl mb-8" style="color: var(--text-primary);">Set Destination</h3>
                            <form class="space-y-4">
                                <input type="url" id="destinationUrl" placeholder="https://your-exclusive-content.com" required>
                                <input type="text" id="title" placeholder="Link Title" required>
                            </form>
                            <div class="flex justify-end mt-8 space-x-4">
                                <button onclick="App.create.nextStep(2)" class="btn-primary px-8 py-4" id="next1" disabled>Next</button>
                            </div>
                        </div>
                        <!-- Step 2: Actions -->
                        <div id="step2" class="wizard-panel">
                            <h3 class="font-black text-3xl mb-8" style="color: var(--text-primary);">Add Actions</h3>
                            <button type="button" onclick="App.ui.openActionModal()" class="btn-primary w-full mb-8">Add Action</button>
                            <ul id="addedActions" class="space-y-4"></ul>
                            <div class="flex justify-between mt-8">
                                <button onclick="App.create.prevStep(1)" class="btn-secondary px-8 py-4">Back</button>
                                <button onclick="App.create.nextStep(3)" class="btn-primary px-8 py-4" id="next2" disabled>Next</button>
                            </div>
                        </div>
                        <!-- Step 3: Customize -->
                        <div id="step3" class="wizard-panel">
                            <h3 class="font-black text-3xl mb-8" style="color: var(--text-primary);">Customize</h3>
                            <div class="space-y-4">
                                <input type="url" id="coverImage" placeholder="Cover Image URL">
                                <input type="text" id="customSlug" placeholder="Custom Slug (e.g., my-link)" value="">
                                <label style="color: var(--text-secondary);">Status</label>
                                <select id="linkStatus">
                                    <option value="active">Active</option>
                                    <option value="paused">Paused</option>
                                </select>
                                <label style="color: var(--text-secondary);">Expire After (days)</label>
                                <input type="number" id="expireDays" placeholder="0 for no expiration" min="0" value="0">
                            </div>
                            <div class="flex justify-between mt-8">
                                <button onclick="App.create.prevStep(2)" class="btn-secondary px-8 py-4">Back</button>
                                <button onclick="App.create.nextStep(4)" class="btn-primary px-8 py-4">Publish</button>
                            </div>
                        </div>
                        <!-- Step 4: Publish -->
                        <div id="step4" class="wizard-panel">
                            <h3 class="font-black text-3xl mb-8" style="color: var(--text-primary);">Publish</h3>
                            <p style="color: var(--text-secondary);">Your link is ready! Share it with your audience.</p>
                            <div class="qr-code">
                                <canvas id="qrCanvas"></canvas>
                                <p id="publishUrl" style="color: var(--text-muted);">https://yoursite.com/unlock/your-slug</p>
                                <button onclick="navigator.clipboard.writeText(document.getElementById('publishUrl').textContent); alert('Copied!');" class="btn-primary mt-4">Copy Link</button>
                            </div>
                            <div class="flex justify-between mt-8">
                                <button onclick="App.create.prevStep(3)" class="btn-secondary px-8 py-4">Back</button>
                                <button onclick="App.create.publishLink()" class="btn-primary px-8 py-4">Launch Link</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Placeholder sections -->
                <div id="shortenedLinks" class="hidden fade-in card">
                    <h3 class="font-bold text-xl mb-6" style="color: var(--text-primary);">Shortened Links</h3>
                    <div id="shortenedList"></div>
                </div>
                <div id="linkInBio" class="hidden fade-in card">
                    <h3 class="font-bold text-xl mb-6" style="color: var(--text-primary);">Link-in-Bio Page</h3>
                    <p style="color: var(--text-secondary);">Coming soon!</p>
                </div>
                <div id="emailLists" class="hidden fade-in card">
                    <h3 class="font-bold text-xl mb-6" style="color: var(--text-primary);">Email Lists</h3>
                    <p style="color: var(--text-secondary);">Coming soon!</p>
                </div>
                <div id="audience" class="hidden fade-in card">
                    <h3 class="font-bold text-xl mb-6" style="color: var(--text-primary);">Audience Insights</h3>
                    <p style="color: var(--text-secondary);">Coming soon!</p>
                </div>
                <div id="files" class="hidden fade-in card">
                    <h3 class="font-bold text-xl mb-6" style="color: var(--text-primary);">File Library</h3>
                    <p style="color: var(--text-secondary);">Coming soon!</p>
                </div>
                <div id="settings" class="hidden fade-in card">
                    <h3 class="font-bold text-xl mb-6" style="color: var(--text-primary);">Account Settings</h3>
                    <form class="space-y-4">
                        <input type="text" placeholder="Username" class="w-full">
                        <button type="submit" class="btn-primary w-full">Save Settings</button>
                    </form>
                </div>
                <div id="analytics" class="hidden fade-in">
                    <div class="card">
                        <h3 class="font-bold text-xl mb-6 flex items-center gap-3" style="color: var(--text-primary);">
                            <i class="fas fa-chart-line text-3xl" style="color: var(--accent);"></i> Advanced Analytics
                        </h3>
                        <div class="analytics-placeholder">
                            <i class="fas fa-chart-bar text-6xl mb-4" style="color: var(--text-muted);"></i>
                            <p style="color: var(--text-secondary);">Detailed analytics coming soon!</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <!-- Enhanced Profile Completion -->
    <div id="profileCompletion" class="profile-completion hidden fade-in">
        <h4 class="font-black flex items-center gap-4 mb-6" style="color: var(--text-primary);">
            <i class="fas fa-trophy text-2xl" style="color: var(--accent);"></i> Complete Profile Setup
        </h4>
        <p class="text-base mb-8 font-semibold" style="color: var(--text-secondary);">1/3 steps - Unlock pro features like custom domains</p>
        <div class="space-y-6 text-sm">
            <div class="flex items-center justify-between py-4 border-b border-[var(--border)] last:border-b-0" style="color: var(--text-secondary);">
                <span class="flex items-center gap-4">
                    <div class="w-3 h-3 bg-[var(--text-muted)] rounded-full"></div>
                    <i class="fas fa-info-circle text-lg"></i>
                    <span>Take the tour</span>
                </span>
                <i class="fas fa-chevron-right text-[var(--accent)] text-lg"></i>
            </div>
            <div class="flex items-center justify-between py-4 border-b border-[var(--border)] last:border-b-0" style="color: var(--accent);">
                <span class="flex items-center gap-4">
                    <div class="w-3 h-3 bg-[var(--accent)] rounded-full"></div>
                    <i class="fas fa-envelope-check text-lg"></i>
                    <span>Verify email</span>
                </span>
                <i class="fas fa-check-circle text-[var(--accent)] text-lg"></i>
            </div>
            <div class="flex items-center justify-between py-4 border-b border-[var(--border)] last:border-b-0" style="color: var(--text-secondary);">
                <span class="flex items-center gap-4">
                    <div class="w-3 h-3 bg-[var(--bg-secondary)] rounded-full border border-[var(--border)]"></div>
                    <i class="fas fa-user-edit text-lg"></i>
                    <span>Set username & profile</span>
                </span>
                <i class="fas fa-chevron-right text-lg"></i>
            </div>
        </div>
        <button class="btn-primary w-full mt-8 flex items-center justify-center gap-3 py-4 text-lg font-bold rounded-2xl" onclick="alert('Profile completed!')">
            <i class="fas fa-arrow-right text-xl"></i> Finish Setup & Unlock Pro
        </button>
    </div>
    <!-- Public Sections with enhanced landing -->
    <div id="publicSections">
        <!-- Super Enhanced Landing Page -->
        <div id="landing" class="min-h-screen flex items-center justify-center px-4 md:px-8 relative overflow-hidden">
            <div class="absolute inset-0">
                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-[var(--accent)]/3 via-transparent to-[var(--accent)]/3"></div>
            </div>
            <div class="relative z-10 max-w-7xl w-full grid md:grid-cols-2 gap-16 items-center text-center md:text-left">
                <div class="fade-in" style="animation-delay: 0.3s;">
                    <div class="mb-8">
                        <span class="inline-block px-6 py-3 bg-gradient-to-r from-[var(--accent)] to-[var(--accent-dark)] text-[var(--text-primary)] text-sm font-bold rounded-full mb-6">
                            <i class="fas fa-star mr-2"></i> Join 50K+ Creators
                        </span>
                    </div>
                    <h1 class="text-5xl md:text-7xl font-black mb-8 leading-tight" style="color: var(--text-primary); background: linear-gradient(135deg, var(--text-primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                        Unlock <span style="background: linear-gradient(135deg, var(--accent), var(--accent-dark)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; display: inline-block;">Real</span> Growth
                    </h1>
                    <p class="text-2xl md:text-3xl mb-12 max-w-lg mx-auto md:mx-0 leading-relaxed" style="color: var(--text-secondary);">
                        Transform passive viewers into engaged fans with smart locked links. Require simple actions like subscribe or like to access premium content â€“ grow your audience effortlessly.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-8 justify-center md:justify-start mb-12">
                        <button onclick="App.ui.showPublic('register')" class="btn-primary px-12 py-6 text-xl font-bold shadow-2xl relative z-10">
                            <i class="fas fa-rocket mr-3 text-xl"></i> Start Free Trial
                        </button>
                        <button onclick="App.ui.showPublic('login')" class="btn-secondary px-12 py-6 text-xl font-bold relative z-10">
                            <i class="fas fa-sign-in-alt mr-3 text-xl"></i> Existing Account
                        </button>
                    </div>
                    <div class="grid grid-cols-3 gap-8 text-center md:text-left">
                        <div class="space-y-2">
                            <p class="text-2xl font-bold" style="color: var(--accent);">50K+</p>
                            <p class="text-sm" style="color: var(--text-muted);">Creators</p>
                        </div>
                        <div class="space-y-2">
                            <p class="text-2xl font-bold" style="color: var(--accent);">1M+</p>
                            <p class="text-sm" style="color: var(--text-muted);">Unlocks</p>
                        </div>
                        <div class="space-y-2">
                            <p class="text-2xl font-bold" style="color: var(--accent);">98%</p>
                            <p class="text-sm" style="color: var(--text-muted);">Uptime</p>
                        </div>
                    </div>
                </div>
                <!-- Enhanced 3D-like card stack -->
                <div class="relative hidden md:block fade-in" style="animation-delay: 0.6s;">
                    <div class="card absolute top-0 right-0 w-80 opacity-60 transform rotate-15 shadow-2xl" style="border: 2px solid var(--border-strong); z-index: 1;"></div>
                    <div class="card absolute top-20 right-20 w-80 opacity-80 transform -rotate-8 shadow-2xl" style="border: 2px solid var(--border-strong); z-index: 2;"></div>
                    <div class="card relative w-96 shadow-2xl z-index: 3;" style="border: 3px solid var(--accent); box-shadow: 0 25px 50px var(--accent-glow);">
                        <div class="h-5 w-40 bg-gradient-to-r from-[var(--accent)] to-[var(--accent-dark)] rounded mb-8 mx-auto shadow-lg"></div>
                        <div class="h-3 w-full bg-[var(--border)] rounded mb-4 mx-auto opacity-70"></div>
                        <div class="h-3 w-5/6 bg-[var(--border)] rounded mx-auto opacity-70"></div>
                        <div class="mt-12 text-center">
                            <i class="fas fa-gem text-5xl mb-4" style="color: var(--accent);"></i>
                            <p class="text-lg font-bold" style="color: var(--text-primary);">Premium Unlocked</p>
                            <p class="text-sm mt-2" style="color: var(--text-muted);">Your reward awaits</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Enhanced Login -->
        <div id="login" class="max-w-lg mx-auto hidden p-6 md:p-12 relative z-20">
            <div class="card glass-effect">
                <div class="text-center mb-10">
                    <i class="fas fa-sign-in-alt text-6xl mb-6" style="color: var(--accent);"></i>
                    <h2 class="text-3xl font-black mb-4" style="color: var(--text-primary);">Sign In to LinkLocker</h2>
                    <p class="text-lg" style="color: var(--text-secondary);">Access your dashboard and unlock the power of gated content</p>
                </div>
                <form id="loginForm" class="space-y-8">
                    <div class="space-y-3">
                        <input type="email" id="loginEmail" placeholder="your.email@example.com" required>
                    </div>
                    <div class="space-y-3">
                        <input type="password" id="loginPassword" placeholder="Enter secure password" required>
                    </div>
                    <button type="submit" class="btn-primary w-full flex items-center justify-center gap-3 py-5 text-xl font-bold">
                        <i class="fas fa-arrow-right text-2xl"></i> Enter Dashboard
                    </button>
                </form>
                <div class="text-center mt-10 pt-8 border-t border-[var(--border)]">
                    <p class="text-[var(--text-muted)] mb-4">New to LinkLocker?</p>
                    <a href="#" onclick="App.ui.showPublic('register'); event.preventDefault();" class="btn-secondary w-full flex items-center justify-center gap-3 py-4 text-lg">
                        <i class="fas fa-user-plus"></i> Create Free Account
                    </a>
                </div>
            </div>
        </div>
        <!-- Register (similar to login) -->
        <div id="register" class="max-w-lg mx-auto hidden p-6 md:p-12 relative z-20">
            <div class="card glass-effect">
                <div class="text-center mb-10">
                    <i class="fas fa-user-plus text-6xl mb-6" style="color: var(--accent);"></i>
                    <h2 class="text-3xl font-black mb-4" style="color: var(--text-primary);">Create LinkLocker Account</h2>
                    <p class="text-lg" style="color: var(--text-secondary);">Join thousands of creators unlocking growth</p>
                </div>
                <form id="registerForm" class="space-y-8">
                    <div class="space-y-3">
                        <input type="text" id="regUsername" placeholder="Username" required>
                    </div>
                    <div class="space-y-3">
                        <input type="email" id="regEmail" placeholder="your.email@example.com" required>
                    </div>
                    <div class="space-y-3">
                        <input type="password" id="regPassword" placeholder="Create secure password" required>
                    </div>
                    <button type="submit" class="btn-primary w-full flex items-center justify-center gap-3 py-5 text-xl font-bold">
                        <i class="fas fa-rocket text-2xl"></i> Start Free Trial
                    </button>
                </form>
                <div class="text-center mt-10 pt-8 border-t border-[var(--border)]">
                    <p class="text-[var(--text-muted)] mb-4">Already have an account?</p>
                    <a href="#" onclick="App.ui.showPublic('login'); event.preventDefault();" class="btn-secondary w-full flex items-center justify-center gap-3 py-4 text-lg">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </a>
                </div>
            </div>
        </div>
        <!-- Public Page with header/footer -->
        <div id="publicPage" class="min-h-screen pt-20 pb-20 hidden relative" style="padding-top: 80px; padding-bottom: 80px;">
            <header class="public-header">
                <div class="flex items-center justify-between max-w-4xl mx-auto">
                    <div class="flex items-center gap-4">
                        <i class="fas fa-lock text-2xl" style="color: var(--accent);"></i>
                        <span style="font-weight: 700; color: var(--text-primary);">LinkLocker</span>
                    </div>
                </div>
            </header>
            <main class="max-w-md mx-auto text-center px-4">
                <img id="publicCover" src="" alt="Cover" class="w-full h-48 object-cover rounded-2xl mb-6" style="display: none;">
                <h1 id="publicTitle" class="text-3xl font-bold mb-6" style="color: var(--text-primary);">Your Exclusive Content</h1>
                <p class="text-lg mb-8" style="color: var(--text-secondary);">Engage with the actions below to reveal the full experience</p>
                <div class="mb-8">
                    <div class="progress">
                        <div id="progressBar" class="progress-bar"></div>
                    </div>
                    <p id="progressText" class="text-base font-semibold mt-3" style="color: var(--text-secondary);">0 / 0</p>
                </div>
                <div id="actionsList" class="space-y-4 mb-8">
                    <!-- Dynamic actions -->
                </div>
                <button id="unlockBtn" class="btn-primary w-full opacity-70 cursor-not-allowed disabled flex items-center justify-center gap-3 py-4 text-lg font-bold rounded-2xl shadow-lg" disabled onclick="App.public.unlockLink()">
                    <i class="fas fa-lock text-xl"></i> ðŸ”’ Unlock Premium Access
                </button>
                <div id="unlockedLink" class="hidden mt-4"></div>
            </main>
            <footer class="public-footer">
                <p style="color: var(--text-muted); font-size: 0.875rem;">Secure unlock â€¢ No spam â€¢ Powered by <span style="color: var(--accent);">LinkLocker</span></p>
            </footer>
        </div>
    </div>
    <!-- Action Modal -->
    <div id="actionModal" class="modal-overlay hidden">
        <div class="card max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-6 text-center" style="color: var(--text-primary);">Add Engagement Action</h3>
            <div class="grid grid-cols-2 gap-4 mb-8">
                <button class="btn-youtube" onclick="App.ui.addAction('youtube_sub')">
                    <i class="fab fa-youtube"></i> YouTube
                </button>
                <button class="btn-instagram" onclick="App.ui.addAction('instagram_follow')">
                    <i class="fab fa-instagram"></i> Instagram
                </button>
                <button class="btn-twitter" onclick="App.ui.addAction('twitter_follow')">
                    <i class="fab fa-twitter"></i> Twitter
                </button>
                <button class="btn-facebook" onclick="App.ui.addAction('facebook_follow')">
                    <i class="fab fa-facebook-f"></i> Facebook
                </button>
                <button class="btn-tiktok" onclick="App.ui.addAction('tiktok_follow')">
                    <i class="fab fa-tiktok"></i> TikTok
                </button>
                <button class="btn-soundcloud" onclick="App.ui.addAction('soundcloud_follow')">
                    <i class="fab fa-soundcloud"></i> SoundCloud
                </button>
                <button class="btn-spotify" onclick="App.ui.addAction('spotify_follow')">
                    <i class="fab fa-spotify"></i> Spotify
                </button>
                <button class="btn-email" onclick="App.ui.addAction('email_capture')">
                    <i class="fas fa-envelope"></i> Email
                </button>
            </div>
            <button onclick="App.ui.closeActionModal()" class="btn-secondary w-full">Cancel</button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        // App Object to organize globals
        const App = {
            state: {
                db: JSON.parse(localStorage.getItem('linklockerDB')) || {
                    users: {},
                    links: [],
                    actions: [],
                    sessions: {},
                    emails: {}, // New for emails per link
                    stats: { views: 0, unlocks: 0, subs: 0 }
                },
                currentUser: null,
                currentLinkId: null,
                visitorSession: null,
                addedActions: [], // {type, url, required: true}
                actionCounter: 0,
                sidebarOpen: false,
                performanceChart: null,
                linkChart: null,
                currentStep: 1,
                currentAnalyzedLink: null
            },
            ui: {
                hideAll() {
                    document.querySelectorAll('#publicSections > div, #mainContent > div').forEach(div => div.classList.add('hidden'));
                    document.getElementById('appLayout').classList.add('hidden');
                    document.getElementById('publicSections').classList.add('hidden');
                    document.getElementById('actionModal').classList.add('hidden');
                    document.getElementById('profileCompletion').classList.add('hidden');
                    this.updateMainContentMargin();
                },
                showPublic(section) {
                    this.hideAll();
                    document.getElementById('publicSections').classList.remove('hidden');
                    document.getElementById(section).classList.remove('hidden');
                    this.updateMainContentMargin();
                },
                showSection(section) {
                    if (!App.state.currentUser) {
                        this.showPublic('login');
                        return;
                    }
                    this.hideAll();
                    document.getElementById('appLayout').classList.remove('hidden');
                    document.getElementById('profileCompletion').classList.remove('hidden');
                    // Update nav
                    document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
                    const navId = `nav${section.charAt(0).toUpperCase() + section.slice(1)}`;
                    document.getElementById(navId)?.classList.add('active');
                    document.getElementById('userEmail').textContent = App.state.currentUser;
                    const el = document.getElementById(section);
                    if (el) {
                        el.classList.remove('hidden');
                        document.getElementById('pageTitle').textContent = section.charAt(0).toUpperCase() + section.slice(1);
                    }
                    if (section === 'dashboard') App.dashboard.load();
                    if (section === 'create') App.create.initWizard();
                    this.updateMainContentMargin();
                },
                toggleSidebar() {
                    if (window.innerWidth > 768) return;
                    App.state.sidebarOpen = !App.state.sidebarOpen;
                    document.getElementById('sidebar').classList.toggle('mobile-hidden', !App.state.sidebarOpen);
                    this.updateMainContentMargin();
                },
                updateMainContentMargin() {
                    const isMobile = window.innerWidth <= 768;
                    const hasSidebar = !document.getElementById('appLayout').classList.contains('hidden') && (!isMobile || App.state.sidebarOpen);
                    document.getElementById('mainContent').classList.toggle('with-sidebar', hasSidebar);
                },
                openActionModal() {
                    document.getElementById('actionModal').classList.remove('hidden');
                },
                closeActionModal() {
                    document.getElementById('actionModal').classList.add('hidden');
                },
                addAction(type) {
                    if (!App.state.addedActions.some(a => a.type === type)) {
                        App.state.addedActions.push({ type, url: '', required: true });
                        this.updateAddedActions();
                        App.create.updatePreview();
                        App.create.validateStep(2);
                    }
                    this.closeActionModal();
                },
                updateAddedActions() {
                    const container = document.getElementById('addedActions');
                    container.innerHTML = App.state.addedActions.map((actionObj, index) => `
                        <li class="sortable-item" draggable="true" ondragstart="App.create.dragStart(event, ${index})" ondragover="App.create.dragOver(event)" ondrop="App.create.drop(event, ${index})">
                            <div class="flex items-center justify-between p-3 bg-[var(--bg-secondary)] rounded-lg">
                                <div class="flex items-center space-x-3 flex-1">
                                    <i class="fas fa-grip-vertical drag-handle"></i>
                                    <div class="btn-${App.utils.getPlatformFromType(actionObj.type)}" style="width: 32px; height: 32px; padding: 0; border-radius: 6px; font-size: 0.75rem; min-width: 32px;">${App.utils.getPlatformEmoji(App.utils.getPlatformFromType(actionObj.type))}</div>
                                    <span style="color: var(--text-primary); flex-1">${App.utils.getActionLabel(actionObj.type)}</span>
                                </div>
                                <div class="flex items-center space-x-2 flex-shrink-0">
                                    <input type="url" placeholder="Enter URL" value="${actionObj.url}" onchange="App.state.addedActions[${index}].url = this.value; App.create.updatePreview(); App.create.validateStep(2);" class="flex-1 max-w-xs">
                                    <label class="flex items-center gap-1 text-sm" style="color: var(--text-secondary);"><input type="checkbox" ${actionObj.required ? 'checked' : ''} onchange="App.state.addedActions[${index}].required = this.checked; App.create.updatePreview();"> Required</label>
                                    <button type="button" onclick="App.state.addedActions.splice(${index}, 1); App.ui.updateAddedActions(); App.create.updatePreview(); App.create.validateStep(2);" style="color: var(--danger); background: none; border: none; cursor: pointer; font-size: 1.25rem; padding: 0 0.5rem;">Ã—</button>
                                </div>
                            </div>
                        </li>
                    `).join('');
                }
            },
            auth: {
                init() {
                    document.getElementById('registerForm').onsubmit = (e) => {
                        e.preventDefault();
                        const username = document.getElementById('regUsername').value;
                        const email = document.getElementById('regEmail').value;
                        const password = document.getElementById('regPassword').value;
                        if (App.state.db.users[email]) {
                            alert('User exists');
                            return;
                        }
                        App.state.db.users[email] = { username, password, createdAt: Date.now() };
                        localStorage.setItem('linklockerDB', JSON.stringify(App.state.db));
                        alert('Registered! Please login.');
                        App.ui.showPublic('login');
                    };
                    document.getElementById('loginForm').onsubmit = (e) => {
                        e.preventDefault();
                        const email = document.getElementById('loginEmail').value;
                        const password = document.getElementById('loginPassword').value;
                        if (App.state.db.users[email] && App.state.db.users[email].password === password) {
                            App.state.currentUser = email;
                            localStorage.setItem('token', email);
                            alert('Logged in!');
                            App.ui.showSection('dashboard');
                        } else {
                            alert('Invalid credentials');
                        }
                    };
                },
                logout() {
                    App.state.currentUser = null;
                    localStorage.removeItem('token');
                    App.state.sidebarOpen = false;
                    App.ui.showPublic('landing');
                }
            },
            dashboard: {
                load() {
                    const userLinks = App.state.db.links.filter(l => l.userId === App.state.currentUser);
                    const totalViews = Object.values(App.state.db.sessions).filter(s => s.viewed).length;
                    const totalUnlocks = Object.values(App.state.db.sessions).filter(s => s.unlocked).length;
                    const totalLinks = userLinks.length;
                    const conversionRate = totalViews > 0 ? Math.round((totalUnlocks / totalViews) * 100) : 0;
                    const emailSubs = Object.keys(App.state.db.emails).length;
                    document.getElementById('totalViews').textContent = totalViews;
                    document.getElementById('totalUnlocks').textContent = totalUnlocks;
                    document.getElementById('conversionRate').textContent = `${conversionRate}%`;
                    document.getElementById('emailSubs').textContent = emailSubs;
                    document.getElementById('totalUnlocksQuick').textContent = totalUnlocks;
                    document.getElementById('welcomeUser').textContent = App.state.db.users[App.state.currentUser]?.username || 'Creator';
                    const list = document.getElementById('linksList');
                    if (userLinks.length === 0) {
                        document.getElementById('dashboardHero').classList.add('hidden');
                        document.getElementById('statsGrid').classList.add('hidden');
                        document.getElementById('noLinksSection').classList.remove('hidden');
                    } else {
                        document.getElementById('dashboardHero').classList.remove('hidden');
                        document.getElementById('statsGrid').classList.remove('hidden');
                        document.getElementById('noLinksSection').classList.add('hidden');
                        list.innerHTML = userLinks.map(link => {
                            const linkActions = App.state.db.actions.filter(a => a.linkId === link._id);
                            const linkSessions = Object.values(App.state.db.sessions).filter(s => s.linkId === link._id);
                            const linkViews = linkSessions.filter(s => s.viewed).length;
                            const linkUnlocks = linkSessions.filter(s => s.unlocked).length;
                            const status = link.status || 'active';
                            const isExpired = link.expireAfter && (Date.now() - link.createdAt > link.expireAfter * 24 * 60 * 60 * 1000);
                            const badgeClass = isExpired ? 'status-expired' : status === 'paused' ? 'status-paused' : 'status-active';
                            return `
                                <div class="link-item card">
                                    <div>
                                        <h4 class="font-medium mb-1" style="color: var(--text-primary);">${link.title}</h4>
                                        <p class="text-sm" style="color: var(--text-muted);">Views: ${linkViews} | Unlocks: ${linkUnlocks}</p>
                                        <p class="text-xs" style="color: var(--text-muted);">https://yoursite.com/unlock/${link.slug}</p>
                                        <span class="status-badge ${badgeClass} mt-2 inline-block">${isExpired ? 'Expired' : status.charAt(0).toUpperCase() + status.slice(1)}</span>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="navigator.clipboard.writeText('https://yoursite.com/unlock/${link.slug}'); alert('Copied!');" class="btn-primary px-4 py-2 text-sm">Copy</button>
                                        <button onclick="App.analytics.showForLink('${link._id}')" class="btn-secondary px-4 py-2 text-sm">Analytics</button>
                                        <button onclick="App.links.toggleStatus('${link._id}')" class="btn-secondary px-4 py-2 text-sm">${status === 'paused' ? 'Resume' : 'Pause'}</button>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                    // Global Chart
                    const ctx = document.getElementById('performanceChart').getContext('2d');
                    if (App.state.performanceChart) App.state.performanceChart.destroy();
                    App.state.performanceChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'Unlocks',
                                data: [12, 19, 3, 5, 2, 3],
                                borderColor: 'rgb(34, 197, 94)',
                                backgroundColor: 'rgba(34, 197, 94, 0.2)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: { y: { beginAtZero: true } },
                            plugins: { legend: { display: false } }
                        }
                    });
                }
            },
            create: {
                initWizard() {
                    App.state.currentStep = 1;
                    this.showStep(1);
                    document.getElementById('title').addEventListener('input', () => {
                        const title = document.getElementById('title').value;
                        const slug = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
                        document.getElementById('customSlug').value = slug;
                        this.validateStep(1);
                    });
                    document.getElementById('destinationUrl').addEventListener('input', () => this.validateStep(1));
                    this.updatePreview();
                },
                showStep(step) {
                    document.querySelectorAll('.wizard-step').forEach((s, i) => {
                        s.classList.toggle('active', i + 1 <= step);
                    });
                    document.querySelectorAll('.wizard-panel').forEach((p, i) => {
                        p.classList.toggle('active', i + 1 === step);
                    });
                    App.state.currentStep = step;
                },
                nextStep(step) {
                    if (this.validateStep(App.state.currentStep)) {
                        this.showStep(step);
                    }
                },
                prevStep(step) {
                    this.showStep(step);
                },
                validateStep(step) {
                    let valid = false;
                    if (step === 1) {
                        valid = document.getElementById('destinationUrl').value && document.getElementById('title').value;
                        document.getElementById('next1').disabled = !valid;
                    } else if (step === 2) {
                        valid = App.state.addedActions.filter(a => a.url).length > 0;
                        document.getElementById('next2').disabled = !valid;
                    } else if (step === 3) {
                        valid = true; // Always valid
                    } else if (step === 4) {
                        valid = true;
                    }
                    return valid;
                },
                updatePreview() {
                    // Similar to before, but only for required actions
                    const requiredActions = App.state.addedActions.filter(a => a.required && a.url);
                    const total = requiredActions.length;
                    document.getElementById('previewProgress').textContent = `0 / ${total}`;
                    // ... rest similar
                },
                dragStart(e, index) {
                    e.dataTransfer.setData('text/plain', index);
                },
                dragOver(e) {
                    e.preventDefault();
                },
                drop(e, dropIndex) {
                    e.preventDefault();
                    const dragIndex = parseInt(e.dataTransfer.getData('text/plain'));
                    if (dragIndex !== dropIndex) {
                        const draggedItem = App.state.addedActions[dragIndex];
                        App.state.addedActions.splice(dragIndex, 1);
                        App.state.addedActions.splice(dropIndex, 0, draggedItem);
                        App.ui.updateAddedActions();
                    }
                },
                publishLink() {
                    // Generate QR
                    const slug = document.getElementById('customSlug').value || Math.random().toString(36).substring(7);
                    const url = `https://scripthub.fun/bypass/sub.html/unlock/${slug}`;
                    document.getElementById('publishUrl').textContent = url;
                    QRCode.toCanvas(document.getElementById('qrCanvas'), url, { width: 200 });
                    // Proceed to create form submit logic
                    const title = document.getElementById('title').value;
                    const destinationUrl = document.getElementById('destinationUrl').value;
                    const coverImage = document.getElementById('coverImage').value || '';
                    const link = {
                        _id: Date.now(),
                        userId: App.state.currentUser,
                        title,
                        destinationUrl,
                        coverImage,
                        slug,
                        status: document.getElementById('linkStatus').value,
                        expireAfter: parseInt(document.getElementById('expireDays').value) * 24 * 60 * 60 * 1000,
                        createdAt: Date.now()
                    };
                    App.state.db.links.push(link);
                    App.state.addedActions.forEach((actionObj) => {
                        if (actionObj.url) {
                            const actionId = `act_${Date.now()}_${App.state.actionCounter++}`;
                            const action = {
                                _id: actionId,
                                linkId: link._id,
                                type: actionObj.type,
                                targetUrl: actionObj.url,
                                required: actionObj.required
                            };
                            App.state.db.actions.push(action);
                        }
                    });
                    localStorage.setItem('linklockerDB', JSON.stringify(App.state.db));
                    alert(`Link launched! ${url}`);
                    App.state.addedActions = [];
                    App.ui.showSection('dashboard');
                }
            },
            analytics: {
                showForLink(linkId) {
                    const link = App.state.db.links.find(l => l._id === linkId);
                    if (!link) return;
                    App.state.currentAnalyzedLink = linkId;
                    document.getElementById('analyticsTitle').textContent = `${link.title} Analytics`;
                    const linkSessions = Object.values(App.state.db.sessions).filter(s => s.linkId === linkId);
                    const views = linkSessions.filter(s => s.viewed).length;
                    const unlocks = linkSessions.filter(s => s.unlocked).length;
                    const conversion = views > 0 ? Math.round((unlocks / views) * 100) : 0;
                    document.getElementById('linkViews').textContent = views;
                    document.getElementById('linkUnlocks').textContent = unlocks;
                    document.getElementById('linkConversion').textContent = `${conversion}%`;
                    const actions = App.state.db.actions.filter(a => a.linkId === linkId);
                    const breakdown = actions.map(action => {
                        const completed = linkSessions.filter(s => s.completedActions.includes(action._id)).length;
                        const rate = actions.length > 0 ? Math.round((completed / linkSessions.length) * 100) : 0;
                        return `<div class="stat-card p-4"><h4 style="color: var(--text-muted);">${App.utils.getActionLabel(action.type)}</h4><p style="font-size: 1.5rem; font-weight: 900; color: var(--text-primary);">${rate}%</p></div>`;
                    }).join('');
                    document.getElementById('actionBreakdown').innerHTML = `<div class="grid grid-cols-2 gap-4">${breakdown}</div>`;
                    // Chart
                    const ctx = document.getElementById('linkChart').getContext('2d');
                    if (App.state.linkChart) App.state.linkChart.destroy();
                    App.state.linkChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: actions.map(a => App.utils.getActionLabel(a.type).substring(0, 10)),
                            datasets: [{
                                label: 'Completion %',
                                data: actions.map(a => {
                                    const completed = linkSessions.filter(s => s.completedActions.includes(a._id)).length;
                                    return linkSessions.length > 0 ? (completed / linkSessions.length) * 100 : 0;
                                }),
                                backgroundColor: 'rgba(34, 197, 94, 0.6)'
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: { y: { beginAtZero: true, max: 100 } },
                            plugins: { legend: { display: false } }
                        }
                    });
                    App.ui.showSection('linkAnalytics');
                }
            },
            links: {
                toggleStatus(linkId) {
                    const link = App.state.db.links.find(l => l._id === linkId);
                    if (link) {
                        link.status = link.status === 'paused' ? 'active' : 'paused';
                        localStorage.setItem('linklockerDB', JSON.stringify(App.state.db));
                        App.dashboard.load();
                    }
                }
            },
            public: {
                load(slug) {
                    const link = App.state.db.links.find(l => l.slug === slug);
                    if (!link) {
                        alert('Link not found');
                        App.ui.showPublic('landing');
                        return;
                    }
                    // Check status
                    const isPaused = link.status === 'paused';
                    const isExpired = link.expireAfter && (Date.now() - link.createdAt > link.expireAfter);
                    if (isPaused || isExpired) {
                        document.getElementById('publicTitle').textContent = isPaused ? 'Link Paused' : 'Link Expired';
                        document.getElementById('actionsList').innerHTML = '<p style="color: var(--warning);">This link is currently unavailable.</p>';
                        App.ui.showPublic('publicPage');
                        return;
                    }
                    App.state.currentLinkId = link._id;
                    document.getElementById('publicTitle').textContent = link.title;
                    const coverEl = document.getElementById('publicCover');
                    if (link.coverImage) {
                        coverEl.src = link.coverImage;
                        coverEl.style.display = 'block';
                    } else {
                        coverEl.style.display = 'none';
                    }
                    App.state.visitorSession = this.getVisitorSession(link._id);
                    if (!App.state.visitorSession.viewed) {
                        App.state.visitorSession.viewed = true;
                        localStorage.setItem('linklockerDB', JSON.stringify(App.state.db));
                    }
                    const actions = App.state.db.actions.filter(a => a.linkId === link._id);
                    document.getElementById('actionsList').innerHTML = actions.map(action => {
                        const platform = App.utils.getPlatformFromType(action.type);
                        const btnClass = `btn-${platform}`;
                        const completed = App.state.visitorSession.completedActions.includes(action._id);
                        if (action.type === 'email_capture') {
                            return `
                                <div class="email-input-container">
                                    <input type="email" id="emailInput_${action._id}" placeholder="Enter your email to unlock" style="border: none; background: none; color: var(--text-primary);">
                                    <button class="${btnClass}" onclick="App.public.completeEmailAction('${action._id}')" ${completed ? 'disabled' : ''} style="border-radius: 8px; margin-top: 0.5rem;">
                                        ${completed ? 'âœ“ Submitted' : 'ðŸ“§ Submit Email'}
                                    </button>
                                </div>
                            `;
                        }
                        return `
                            <div class="relative">
                                <button class="${btnClass} ${completed ? 'opacity-70 cursor-not-allowed' : ''}" onclick="App.public.completeAction('${action._id}', '${action.targetUrl}', '${action.type}')" ${completed ? 'disabled' : ''} style="border-radius: 8px;">
                                    ${completed ? 'âœ” Verified' : `â–¶ ${App.utils.getActionLabel(action.type)}`}
                                </button>
                                ${!completed ? `<label class="verification-checkbox block mt-2 text-xs" style="color: var(--text-muted);"><input type="checkbox" onchange="if(this.checked) setTimeout(() => { this.checked = false; alert('Verification requires tab focus for 8s'); }, 8000);"> Confirm completion</label>` : ''}
                            </div>
                        `;
                    }).join('');
                    this.updateProgress();
                    App.ui.showPublic('publicPage');
                },
                getVisitorSession(linkId) {
                    const visitorId = sessionStorage.getItem('visitorId') || Math.random().toString(36);
                    sessionStorage.setItem('visitorId', visitorId);
                    const key = `${visitorId}_${linkId}`;
                    if (!App.state.db.sessions[key]) {
                        App.state.db.sessions[key] = {
                            _id: Date.now(),
                            linkId,
                            visitorId,
                            completedActions: [],
                            unlocked: false,
                            viewed: false,
                            createdAt: Date.now()
                        };
                        localStorage.setItem('linklockerDB', JSON.stringify(App.state.db));
                    }
                    if (Date.now() - App.state.db.sessions[key].createdAt > 24 * 60 * 60 * 1000) {
                        App.state.db.sessions[key].completedActions = [];
                        App.state.db.sessions[key].unlocked = false;
                        App.state.db.sessions[key].viewed = false;
                        App.state.db.sessions[key].createdAt = Date.now();
                        localStorage.setItem('linklockerDB', JSON.stringify(App.state.db));
                    }
                    return App.state.db.sessions[key];
                },
                completeAction(actionId, url, type) {
                    if (App.state.visitorSession.completedActions.includes(actionId)) return;
                    const btn = event.target;
                    btn.disabled = true;
                    btn.innerHTML = '<div class="spinner"></div> Verifying...';
                    window.open(url, '_blank');
                    setTimeout(() => {
                        const checkbox = btn.nextElementSibling?.querySelector('input[type="checkbox"]');
                        if (checkbox && !checkbox.checked) {
                            btn.disabled = false;
                            btn.innerHTML = `â–¶ ${App.utils.getActionLabel(type)}`;
                            alert('Please confirm completion after visiting the page.');
                            return;
                        }
                        App.state.visitorSession.completedActions.push(actionId);
                        App.state.db.stats.subs += 1;
                        localStorage.setItem('linklockerDB', JSON.stringify(App.state.db));
                        btn.innerHTML = 'âœ” Verified';
                        btn.classList.add('opacity-70', 'cursor-not-allowed');
                        this.updateProgress();
                        const popup = document.createElement('div');
                        popup.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                        popup.innerHTML = `
                            <div class="card p-8 max-w-md mx-auto text-center">
                                <i class="fas fa-check-circle text-6xl mb-4" style="color: var(--success);"></i>
                                <h3 class="text-2xl font-bold mb-4" style="color: var(--text-primary);">Action Verified!</h3>
                                <p class="text-lg mb-6" style="color: var(--text-secondary);">Your ${App.utils.getActionLabel(type)} has been confirmed. Progress updated!</p>
                                <button onclick="this.parentElement.parentElement.remove()" class="btn-primary px-8 py-4">Continue</button>
                            </div>
                        `;
                        document.body.appendChild(popup);
                    }, 8000);
                },
                completeEmailAction(actionId) {
                    const email = document.getElementById(`emailInput_${actionId}`).value;
                    if (!email || !email.includes('@')) {
                        alert('Please enter a valid email');
                        return;
                    }
                    if (App.state.visitorSession.completedActions.includes(actionId)) return;
                    App.state.visitorSession.completedActions.push(actionId);
                    if (!App.state.db.emails[App.state.currentLinkId]) App.state.db.emails[App.state.currentLinkId] = [];
                    App.state.db.emails[App.state.currentLinkId].push({ email, timestamp: Date.now() });
                    localStorage.setItem('linklockerDB', JSON.stringify(App.state.db));
                    const btn = event.target;
                    btn.innerHTML = 'âœ“ Submitted';
                    btn.disabled = true;
                    this.updateProgress();
                },
                updateProgress() {
                    const actions = App.state.db.actions.filter(a => a.linkId === App.state.currentLinkId && a.required);
                    const total = actions.length;
                    const completed = App.state.visitorSession.completedActions.filter(id => actions.some(a => a._id === id)).length;
                    document.getElementById('progressText').textContent = `${completed} / ${total}`;
                    document.getElementById('progressBar').style.width = `${(completed / total) * 100 || 0}%`;
                    const unlockBtn = document.getElementById('unlockBtn');
                    if (completed === total && !App.state.visitorSession.unlocked) {
                        unlockBtn.disabled = false;
                        unlockBtn.style.opacity = '1';
                        unlockBtn.style.cursor = 'pointer';
                        unlockBtn.innerHTML = '<i class="fas fa-unlock-alt text-xl"></i> ðŸ”“ Unlock link';
                    }
                },
                unlockLink() {
                    const unlockBtn = document.getElementById('unlockBtn');
                    unlockBtn.innerHTML = '<div class="spinner"></div> Unlocking...';
                    unlockBtn.disabled = true;
                    let countdown = 3;
                    const countdownEl = document.createElement('div');
                    countdownEl.className = 'countdown';
                    unlockBtn.parentNode.insertBefore(countdownEl, unlockBtn.nextSibling);
                    const interval = setInterval(() => {
                        countdown--;
                        countdownEl.textContent = countdown;
                        if (countdown <= 0) {
                            clearInterval(interval);
                            App.state.visitorSession.unlocked = true;
                            App.state.db.stats.unlocks += 1;
                            localStorage.setItem('linklockerDB', JSON.stringify(App.state.db));
                            unlockBtn.style.display = 'none';
                            const link = App.state.db.links.find(l => l._id === App.state.currentLinkId);
                            document.getElementById('unlockedLink').innerHTML = `<a href="${link.destinationUrl}" target="_blank" class="btn-primary block w-full text-center" style="border-radius: 8px;"><i class="fas fa-rocket text-xl"></i> ðŸ”“ Unlocked! Go to Destination</a>`;
                            document.getElementById('unlockedLink').classList.remove('hidden');
                            const successPopup = document.createElement('div');
                            successPopup.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                            successPopup.innerHTML = `
                                <div class="card p-8 max-w-md mx-auto text-center">
                                    <i class="fas fa-rocket text-6xl mb-4" style="color: var(--success); animation: spin 2s linear infinite;"></i>
                                    <h3 class="text-2xl font-bold mb-4" style="color: var(--text-primary);">Unlocked Successfully!</h3>
                                    <p class="text-lg mb-6" style="color: var(--text-secondary);">Redirecting to your content...</p>
                                    <button onclick="this.parentElement.parentElement.remove(); window.location.href = '${link.destinationUrl}';" class="btn-primary px-8 py-4">Go Now</button>
                                </div>
                            `;
                            document.body.appendChild(successPopup);
                        }
                    }, 1000);
                }
            },
            utils: {
                getPlatformFromType(type) {
                    if (type.includes('youtube')) return 'youtube';
                    if (type.includes('instagram')) return 'instagram';
                    if (type.includes('twitter')) return 'twitter';
                    if (type.includes('facebook')) return 'facebook';
                    if (type.includes('tiktok')) return 'tiktok';
                    if (type.includes('soundcloud')) return 'soundcloud';
                    if (type.includes('spotify')) return 'spotify';
                    if (type === 'email_capture') return 'email';
                    return 'primary';
                },
                getPlatformEmoji(platform) {
                    const emojis = {
                        youtube: 'â–¶',
                        instagram: 'â™¥',
                        twitter: 'â™¥',
                        facebook: 'â™¥',
                        tiktok: 'â™¥',
                        soundcloud: 'â™¥',
                        spotify: 'â™¥',
                        email: 'ðŸ“§'
                    };
                    return emojis[platform] || 'â–¶';
                },
                getActionLabel(type) {
                    const labels = {
                        youtube_sub: 'Subscribe to channel',
                        instagram_follow: 'Follow user',
                        twitter_follow: 'Follow user',
                        facebook_follow: 'Follow user',
                        tiktok_follow: 'Follow user',
                        soundcloud_follow: 'Follow user',
                        spotify_follow: 'Follow artist',
                        email_capture: 'Enter email'
                    };
                    return labels[type] || type;
                }
            }
        };

        // Init
        App.auth.init();
        App.ui.updateMainContentMargin();
        window.addEventListener('resize', () => App.ui.updateMainContentMargin());
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('slug')) {
            App.public.load(urlParams.get('slug'));
        } else if (localStorage.getItem('token')) {
            App.state.currentUser = localStorage.getItem('token');
            App.ui.showSection('dashboard');
        } else {
            App.ui.showPublic('landing');
        }
    </script>
</body>
</html>
