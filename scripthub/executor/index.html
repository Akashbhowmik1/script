<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Link Bypasser - Grok Style</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary:#000; --bg-secondary:#0a0a0a; --text-primary:#fff; --text-secondary:#b3b3b3;
      --accent:#1d9bf0; --border:#333; --user-bubble:#1f1f1f; --bot-bubble:#1a1a1a; --input-bg:#111;
      --error:#ff4444; --success:#00ff88;
    }
    @media (prefers-color-scheme: light) {
      :root { --bg-primary:#fff; --bg-secondary:#f5f5f5; --text-primary:#000; --text-secondary:#666; --accent:#1d9bf0;
              --border:#e0e0e0; --user-bubble:#e6f0ff; --bot-bubble:#f0f0f0; --input-bg:#fff; }
    }
    body{margin:0;padding:0;font-family:'Inter',system-ui,-apple-system,sans-serif;background:var(--bg-primary);color:var(--text-primary);display:flex;flex-direction:column;height:100vh;overflow:hidden}
    header{background:var(--bg-secondary);border-bottom:1px solid var(--border);padding:16px;text-align:center;position:relative;z-index:10}
    header h1{font-size:24px;margin:0;font-weight:700;background:linear-gradient(90deg,#1d9bf0,#00ff88);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    header p{font-size:14px;color:var(--text-secondary);margin:8px 0 0}
    #clear-btn{position:absolute;right:16px;top:50%;transform:translateY(-50%);background:transparent;border:1px solid var(--border);color:var(--text-primary);padding:8px 16px;border-radius:999px;cursor:pointer;font-size:14px;transition:all .2s}
    #clear-btn:hover{background:var(--accent);border-color:var(--accent)}
    #chat-container{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:24px;scrollbar-width:thin}
    #chat-container::-webkit-scrollbar{width:8px}
    #chat-container::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
    .message{max-width:800px;align-self:flex-start;display:flex;gap:12px}
    .message.user{align-self:flex-end;flex-direction:row-reverse}
    .avatar{width:40px;height:40px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;flex-shrink:0}
    .message.user .avatar{background:#00ff88;color:#000}
    .bubble{background:var(--bot-bubble);padding:16px 20px;border-radius:20px;border-top-left-radius:4px;font-size:16px;line-height:1.6;box-shadow:0 2px 8px rgba(0,0,0,.1);word-wrap:break-word;white-space:pre-wrap}
    .message.user .bubble{background:var(--user-bubble);border-top-right-radius:4px;border-top-left-radius:20px}
    .bubble a{color:var(--accent);text-decoration:underline}
    .bubble.error{color:var(--error)}
    .bubble.success{color:var(--success)}
    .typing-indicator{display:flex;gap:8px;padding:16px 20px}
    .typing-indicator span{width:8px;height:8px;background:var(--text-secondary);border-radius:50%;animation:typing 1.4s infinite}
    .typing-indicator span:nth-child(2){animation-delay:.2s}
    .typing-indicator span:nth-child(3){animation-delay:.4s}
    @keyframes typing{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
    #input-container{background:var(--bg-secondary);border-top:1px solid var(--border);padding:16px;display:flex;gap:12px;align-items:end}
    #user-input{flex:1;background:var(--input-bg);border:1px solid var(--border);color:var(--text-primary);padding:14px 20px;border-radius:999px;font-size:16px;resize:none;min-height:48px;max-height:200px;overflow-y:auto}
    #user-input:focus{outline:none;border-color:var(--accent)}
    #send-btn{background:var(--accent);color:#fff;border:none;width:48px;height:48px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
    #send-btn:hover{background:#1a8cd8;transform:scale(1.05)}
    #send-btn:disabled{opacity:.5;cursor:not-allowed}
    .send-icon{width:20px;height:20px;fill:#fff}
    @media (max-width:768px){#chat-container{padding:16px;gap:16px}.bubble{padding:14px 18px;font-size:15px}#input-container{padding:12px}#clear-btn{position:static;transform:none;margin-top:12px;width:100%}}
  </style>
</head>
<body>
  <header>
    <h1>Link Bypasser</h1>
    <p>Paste your ad-link (Linkvertise, Work.ink, etc.) to get the direct link</p>
    <button id="clear-btn">Clear Chat</button>
  </header>

  <div id="chat-container"></div>

  <div id="input-container">
    <textarea id="user-input" rows="1" placeholder="Paste your link here..."></textarea>
    <button id="send-btn" disabled>
      <svg class="send-icon" viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/></svg>
    </button>
  </div>

  <script>
    // ===== CONFIG: point to your Cloudflare Worker (24/7) =====
    const API_ENDPOINT = 'https://steep-pine-9afc.akashbhowmik110.workers.dev/bypass';
    const API_REFRESH_ENDPOINT = 'https://steep-pine-9afc.akashbhowmik110.workers.dev/refresh';
    const API_METHOD = 'GET';
    // ==========================================================

    const chatContainer = document.getElementById('chat-container');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const clearBtn = document.getElementById('clear-btn');

    // Auto-resize + enable send
    userInput.addEventListener('input', () => {
      userInput.style.height = 'auto';
      userInput.style.height = userInput.scrollHeight + 'px';
      sendBtn.disabled = userInput.value.trim() === '';
    });

    let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
    renderChatHistory();

    function renderChatHistory() {
      chatContainer.innerHTML = '';
      chatHistory.forEach(msg => addMessage(msg.sender, msg.text, msg.isError || false, false));
      scrollToBottom();
    }

    function addMessage(sender, text, isError = false, animate = true) {
      const msgDiv = document.createElement('div');
      msgDiv.classList.add('message', sender);

      const avatar = document.createElement('div');
      avatar.classList.add('avatar');
      avatar.textContent = sender === 'user' ? 'U' : 'B';

      const bubble = document.createElement('div');
      bubble.classList.add('bubble');
      if (isError) bubble.classList.add('error');

      const urlRegex = /(https?:\/\/[^\s]+)/g;
      if (urlRegex.test(text)) {
        const parts = text.split(urlRegex);
        parts.forEach(part => {
          if (urlRegex.test(part)) {
            const a = document.createElement('a');
            a.href = part;
            a.textContent = part;
            a.target = '_blank';
            a.rel = 'noopener noreferrer';
            bubble.appendChild(a);
          } else {
            bubble.appendChild(document.createTextNode(part));
          }
        });
      } else {
        bubble.textContent = text;
      }

      msgDiv.appendChild(avatar);
      msgDiv.appendChild(bubble);
      chatContainer.appendChild(msgDiv);

      if (animate) scrollToBottom();
    }

    function addTypingIndicator() {
      const typingDiv = document.createElement('div');
      typingDiv.classList.add('message');
      typingDiv.id = 'typing';

      const avatar = document.createElement('div');
      avatar.classList.add('avatar');
      avatar.textContent = 'B';

      const indicator = document.createElement('div');
      indicator.classList.add('bubble', 'typing-indicator');
      indicator.innerHTML = '<span></span><span></span><span></span>';

      typingDiv.appendChild(avatar);
      typingDiv.appendChild(indicator);
      chatContainer.appendChild(typingDiv);
      scrollToBottom();
    }

    function removeTypingIndicator() {
      const typing = document.getElementById('typing');
      if (typing) typing.remove();
    }

    function scrollToBottom() {
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function saveChatHistory() {
      localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    }

    function clearChat() {
      if (chatHistory.length === 0) {
        alert("Chat is already empty!");
        return;
      }
      if (confirm("Clear all chat history? This cannot be undone.")) {
        chatHistory = [];
        localStorage.removeItem('chatHistory');
        renderChatHistory();
      }
    }

    async function bypassLink(link, useRefresh=false) {
      try {
        let url = (useRefresh ? API_REFRESH_ENDPOINT : API_ENDPOINT);
        url += (url.includes('?') ? '&' : '?') + 'url=' + encodeURIComponent(link.trim());

        const resp = await fetch(url, { method: API_METHOD, redirect: 'follow', headers: { 'Accept': 'application/json' } });

        if (!resp.ok) {
          const txt = await resp.text().catch(()=>null);
          throw new Error(`HTTP ${resp.status}: ${resp.statusText}${txt ? '\n' + txt : ''}`);
        }

        const contentType = resp.headers.get('content-type') || '';
        if (contentType.includes('application/json')) {
          const data = await resp.json();
          if (data.success && data.destination) return { text: `Bypassed successfully! ðŸŽ‰\nDirect link: ${data.destination}`, isError:false };
          if (data.status === 'success' && data.result) return { text: `Bypassed successfully! ðŸŽ‰\nDirect link: ${data.result}`, isError:false };
          if (data.bypassed || data.direct_url) return { text: `Bypassed successfully! ðŸŽ‰\nDirect link: ${data.bypassed || data.direct_url}`, isError:false };
          return { text: `Bypass completed:\n${JSON.stringify(data, null, 2)}`, isError:false };
        } else {
          const text = await resp.text();
          const m = text.match(/https?:\/\/[^\s'"]+/);
          if (m) return { text: `Bypassed successfully! ðŸŽ‰\nDirect link: ${m[0]}`, isError:false };
          return { text: text || 'Bypass completed (no response body)', isError:false };
        }
      } catch (err) {
        console.error('Bypass error:', err);
        return { text: `Error: ${err.message}\nPossible causes: CORS/origin not allowed in Worker, API rate limit, or unsupported link.`, isError:true };
      }
    }

    async function handleSend() {
      const inputText = userInput.value.trim();
      if (!inputText) return;

      if (!inputText.startsWith('http://') && !inputText.startsWith('https://')) {
        addMessage('bot', 'Please enter a valid URL starting with http:// or https://', true);
        return;
      }

      addMessage('user', inputText);
      chatHistory.push({ sender:'user', text:inputText });
      saveChatHistory();

      userInput.value = '';
      userInput.style.height = 'auto';
      sendBtn.disabled = true;

      addTypingIndicator();
      const { text, isError } = await bypassLink(inputText, false);
      removeTypingIndicator();

      addMessage('bot', text, isError);
      chatHistory.push({ sender:'bot', text, isError });
      saveChatHistory();
    }

    sendBtn.addEventListener('click', handleSend);
    userInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    });
    clearBtn.addEventListener('click', clearChat);

    sendBtn.disabled = true;
  </script>
</body>
</html>
